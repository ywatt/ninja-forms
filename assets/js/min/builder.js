!function(){var e,t,n;!function(i){function r(e,t){return b.call(e,t)}function a(e,t){var n,i,r,a,l,o,s,c,d,h,u,p=t&&t.split("/"),g=w.map,f=g&&g["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=e.split("/"),l=e.length-1,w.nodeIdCompat&&j.test(e[l])&&(e[l]=e[l].replace(j,"")),e=p.slice(0,p.length-1).concat(e),d=0;d<e.length;d+=1)if(u=e[d],"."===u)e.splice(d,1),d-=1;else if(".."===u){if(1===d&&(".."===e[2]||".."===e[0]))break;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||f)&&g){for(n=e.split("/"),d=n.length;d>0;d-=1){if(i=n.slice(0,d).join("/"),p)for(h=p.length;h>0;h-=1)if(r=g[p.slice(0,h).join("/")],r&&(r=r[i])){a=r,o=d;break}if(a)break;!s&&f&&f[i]&&(s=f[i],c=d)}!a&&s&&(a=s,o=c),a&&(n.splice(0,o,a),e=n.join("/"))}return e}function l(e,t){return function(){var n=C.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),p.apply(i,n.concat([e,t]))}}function o(e){return function(t){return a(t,e)}}function s(e){return function(t){m[e]=t}}function c(e){if(r(v,e)){var t=v[e];delete v[e],y[e]=!0,u.apply(i,t)}if(!r(m,e)&&!r(y,e))throw new Error("No "+e);return m[e]}function d(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function h(e){return function(){return w&&w.config&&w.config[e]||{}}}var u,p,g,f,m={},v={},w={},y={},b=Object.prototype.hasOwnProperty,C=[].slice,j=/\.js$/;g=function(e,t){var n,i=d(e),r=i[0];return e=i[1],r&&(r=a(r,t),n=c(r)),r?e=n&&n.normalize?n.normalize(e,o(t)):a(e,t):(e=a(e,t),i=d(e),r=i[0],e=i[1],r&&(n=c(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:n}},f={require:function(e){return l(e)},exports:function(e){var t=m[e];return"undefined"!=typeof t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:h(e)}}},u=function(e,t,n,a){var o,d,h,u,p,w,b=[],C=typeof n;if(a=a||e,"undefined"===C||"function"===C){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(u=g(t[p],a),d=u.f,"require"===d)b[p]=f.require(e);else if("exports"===d)b[p]=f.exports(e),w=!0;else if("module"===d)o=b[p]=f.module(e);else if(r(m,d)||r(v,d)||r(y,d))b[p]=c(d);else{if(!u.p)throw new Error(e+" missing "+d);u.p.load(u.n,l(a,!0),s(d),{}),b[p]=m[d]}h=n?n.apply(m[e],b):void 0,e&&(o&&o.exports!==i&&o.exports!==m[e]?m[e]=o.exports:h===i&&w||(m[e]=h))}else e&&(m[e]=n)},e=t=p=function(e,t,n,r,a){if("string"==typeof e)return f[e]?f[e](t):c(g(e,t).f);if(!e.splice){if(w=e,w.deps&&p(w.deps,w.callback),!t)return;t.splice?(e=t,t=n,n=null):e=i}return t=t||function(){},"function"==typeof n&&(n=r,r=a),r?u(i,e,t,n):setTimeout(function(){u(i,e,t,n)},4),p},p.config=function(e){return p(e)},e._defined=m,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),r(m,e)||r(v,e)||(v[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../lib/almond",function(){}),n("views/app/menuItem",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-app-menu-item",initialize:function(){this.listenTo(i.channel("app"),"change:currentDomain",this.render),this.model.on("change",this.render,this)},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},events:{"click a":"clickAppMenu"},clickAppMenu:function(e){i.channel("app").trigger("click:menu",e,this.model)},templateHelpers:function(){return{renderDashicons:function(){return this.dashicons?'<span class="dashicons '+this.dashicons+'"></span>':""},renderClasses:function(){var e=this.classes,t=i.channel("app").request("get:currentDomain");return t.get("id")==this.id&&(e+=" active"),e},renderUrl:function(){return""!=this.url?this.url:"#"},renderTarget:function(){return""!=this.url?"_blank":"_self"},renderDisabled:function(){return this.disabled?"disabled":""}}}});return e}),n("views/app/menu",["views/app/menuItem"],function(e){var t=Marionette.CollectionView.extend({tagName:"div",childView:e,onShow:function(){jQuery(this.el).find("li:last").unwrap()}});return t}),n("views/app/menuButtons",[],function(){var e=Marionette.ItemView.extend({tagName:"span",template:"#nf-tmpl-app-header-action-button",initialize:function(){this.listenTo(i.channel("app"),"change:clean",this.render,this),this.listenTo(i.channel("app"),"change:loading",this.render,this)},templateHelpers:function(){var e=this;return{renderPublish:function(){return e.publishWidth?this.publishWidth='style="width:'+e.publishWidth+'px !important"':this.publishWidth="",i.channel("app").request("get:setting","loading")?_.template(jQuery("#nf-tmpl-add-header-publish-loading").html(),this):_.template(jQuery("#nf-tmpl-app-header-publish-button").html(),this)},maybeDisabled:function(){return i.channel("app").request("get:setting","clean")?"disabled":""},maybeRenderCancel:function(){return i.channel("app").request("get:setting","clean")?"":_.template(jQuery("#nf-tmpl-app-header-view-changes").html(),this)}}},onShow:function(){var e=jQuery(this.el).find(".publish");this.publishWidth=jQuery(e).outerWidth(!0)},events:{"click .publish":"clickPublish","click .viewChanges":"clickViewChanges"},clickPublish:function(e){i.channel("app").trigger("click:publish",e)},clickViewChanges:function(e){i.channel("app").trigger("click:viewChanges",e)}});return e}),n("views/app/header",["views/app/menu","views/app/menuButtons"],function(e,t){var n=Marionette.LayoutView.extend({tagName:"div",template:"#nf-tmpl-app-header",regions:{menu:".nf-app-menu",buttons:".nf-app-buttons"},onShow:function(){var n=i.channel("app").request("get:domainCollection");this.menu.show(new e({collection:n})),this.buttons.show(new t)}});return n}),n("views/app/subHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-sub-header"});return e}),n("views/app/formTitle",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-header-form-title",initialize:function(){this.model.on("change:title",this.render,this)},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},templateHelpers:function(){return{renderTitle:function(){var e=i.channel("app").request("get:formData");return e.get("settings").get("title")}}}});return e}),n("views/app/builderHeader",["views/app/header","views/app/subHeader","views/app/formTitle"],function(e,t,n){var r=Marionette.LayoutView.extend({tagName:"div",template:"#nf-tmpl-header",regions:{app:"#nf-app-header",formTitle:"#nf-app-form-title",appSub:"#nf-app-sub-header"},initialize:function(){this.listenTo(i.channel("app"),"change:currentDomain",this.changeSubHeader)},onShow:function(){this.app.show(new e);var t=i.channel("app").request("get:formData"),r=t.get("settings");this.formTitle.show(new n({model:r})),this.changeSubHeader()},changeSubHeader:function(){var e=i.channel("app").request("get:currentDomain"),t=e.get("getSubHeaderView").call(e);this.appSub.show(t)}});return r}),n("views/app/main",[],function(){var e=Marionette.LayoutView.extend({tagName:"div",template:"#nf-tmpl-main",regions:{header:"#nf-main-header",content:"#nf-main-content"},initialize:function(){this.listenTo(i.channel("app"),"change:currentDomain",this.render),i.channel("app").reply("get:mainEl",this.getMainEl,this)},onShow:function(){jQuery(this.el).parent().perfectScrollbar(),i.channel("main").trigger("show:main"),jQuery(this.el).parent().disableSelection()},onRender:function(){var e=i.channel("app").request("get:currentDomain"),t=e.get("getMainContentView").call(e);this.content.show(t),i.channel("main").trigger("render:main")},getMainEl:function(){return jQuery(this.el).parent()}});return e}),n("views/app/drawer/mobileMenu",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-menu-drawer"});return e}),n("views/app/drawer/headerDefault",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-drawer-header-default",onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el),i.channel("drawer").reply("clear:filter",this.clearFilter,this),i.channel("drawer").reply("blur:filter",this.blurFilter,this),i.channel("drawer").reply("get:filterEl",this.getEl,this)},events:{"keyup .nf-filter":"maybeChangeFilter","input .nf-filter":"changeFilter","focus input":"getFocus"},changeFilter:function(e){var t=i.channel("app").request("get:currentDrawer");i.channel("drawer-"+t.get("id")).trigger("change:filter",e.target.value,e)},maybeChangeFilter:function(e){13==e.keyCode&&(e.addObject=!0,this.changeFilter(e))},clearFilter:function(){var e=jQuery(this.el).find(".nf-filter");""!=jQuery.trim(e.val())&&(e.val(""),e.trigger("input"),e.focus())},blurFilter:function(){jQuery(this.el).find(".nf-filter").blur()},getEl:function(){return jQuery(this.el).find(".nf-filter")},getFocus:function(){i.channel("drawer").trigger("filter:focused")}});return e}),n("views/app/drawer/contentEmpty",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-drawer-content-empty"});return e}),n("views/app/drawer",["views/app/drawer/headerDefault","views/app/drawer/contentEmpty"],function(e,t){var n=Marionette.LayoutView.extend({template:"#nf-tmpl-drawer",regions:{header:"#nf-drawer-header",content:"#nf-drawer-content"},initialize:function(){i.channel("app").reply("get:drawerEl",this.getEl,this),i.channel("drawer").reply("load:drawerContent",this.loadContent,this),i.channel("drawer").reply("empty:drawerContent",this.emptyContent,this)},onShow:function(){jQuery(this.el).parent().perfectScrollbar()},loadContent:function(e,t){var n=i.channel("app").request("get:drawer",e),r=n.get("getContentView").call(n,t),a=n.get("getHeaderView").call(n,t);this.header.show(a),this.content.show(r)},emptyContent:function(){this.header.show(new t),this.content.show(new t)},getEl:function(){return jQuery(this.el).parent()},events:{"click .nf-toggle-drawer":"clickToggleDrawer"},clickToggleDrawer:function(){i.channel("app").trigger("click:toggleDrawerSize")}});return n}),n("views/app/drawer/mergeTagItem",[],function(){var e=Marionette.ItemView.extend({tagName:"li",template:"#nf-tmpl-merge-tags-item",onBeforeDestroy:function(){this.model.off("change:active",this.render)},initialize:function(){this.model.on("change:active",this.render,this)},events:{"click a":"clickTag"},clickTag:function(e){i.channel("mergeTags").trigger("click:mergeTag",e,this.model)},templateHelpers:function(){return{renderClasses:function(){return this.active?"active":void 0}}}});return e}),n("views/app/drawer/mergeTagsSection",["views/app/drawer/mergeTagItem"],function(e){var t=Marionette.CompositeView.extend({tagName:"div",childView:e,template:"#nf-tmpl-merge-tags-section",initialize:function(){if(this.collection=this.model.get("tags"),this.model.on("change",this.render,this),"fields"==this.model.get("id")){var e=i.channel("fields").request("get:collection");e.on("all",this.updateFields,this)}},onBeforeDestroy:function(){if("fields"==this.model.get("id")){var e=i.channel("fields").request("get:collection");e.off("all",this.updateFields,this)}},attachHtml:function(e,t){jQuery(e.el).find(".merge-tags").append(t.el)},updateFields:function(){var e=i.channel("fields").request("get:collection");this.model.set("tags",e)}});return t}),n("views/app/drawer/mergeTagsContent",["views/app/drawer/mergeTagsSection"],function(e){var t=Marionette.CollectionView.extend({tagName:"div",template:"#nf-tmpl-merge-tags-content",childView:e});return t}),n("views/app/builder",["views/app/builderHeader","views/app/main","views/app/drawer/mobileMenu","views/app/drawer","views/app/drawer/mergeTagsContent"],function(e,t,n,r,a){var l=Marionette.LayoutView.extend({template:"#nf-tmpl-builder",el:"#nf-builder",regions:{header:"#nf-header",main:"#nf-main",menuDrawer:"#nf-menu-drawer",drawer:"#nf-drawer",mergeTagsContent:".merge-tags-content"},initialize:function(){this.render();var n=i.channel("mergeTags").request("get:mergeTags");this.mergeTagsContent.show(new a({collection:n})),this.header.show(new e),this.main.show(new t),this.drawer.show(new r),i.channel("app").reply("get:builderEl",this.getBuilderEl,this)},getBuilderEl:function(){return this.el},events:{"click .nf-open-drawer":"openDrawer","click .nf-change-domain":"changeDomain","click .nf-close-drawer":"closeDrawer"},openDrawer:function(e){i.channel("app").trigger("click:openDrawer",e)},closeDrawer:function(){i.channel("app").trigger("click:closeDrawer")},changeDomain:function(e){i.channel("app").trigger("click:menu",e)}});return l}),n("controllers/app/drawer",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"click:openDrawer",this.clickOpenDrawer),this.listenTo(i.channel("app"),"click:closeDrawer",this.closeDrawer),this.listenTo(i.channel("app"),"click:toggleDrawerSize",this.toggleDrawerSize),i.channel("app").reply("open:drawer",this.openDrawer,this),i.channel("app").reply("close:drawer",this.closeDrawer,this),i.channel("drawer").reply("get:closedRightPos",this.getClosedDrawerPos,this),i.channel("drawer").reply("prevent:close",this.preventClose,this),i.channel("drawer").reply("enable:close",this.enableClose,this),this.objPreventClose={},this.listenTo(i.channel("drawer"),"filter:focused",this.filterFocused)},closeDrawer:function(){var e=i.channel("app").request("get:currentDrawer");if(!e||this.maybePreventClose())return!1;i.channel("drawer-"+e.get("id")).trigger("before:closeDrawer"),i.channel("drawer").trigger("before:closeDrawer"),i.channel("drawer").request("empty:drawerContent");var t=i.channel("app").request("get:builderEl");jQuery(t).addClass("nf-drawer-closed").removeClass("nf-drawer-opened");var n=this.getClosedDrawerPos(),r=i.channel("app").request("get:drawerEl");jQuery(r).css({right:n});var a=this;this.checkCloseDrawerPos=setInterval(function(){n==jQuery(r).css("right")&&(clearInterval(a.checkCloseDrawerPos),i.channel("app").request("update:currentDrawer",!1),i.channel("drawer").trigger("closed"))},150)},clickOpenDrawer:function(e){var t=jQuery(e.target).data("drawerid");this.openDrawer(t)},openDrawer:function(e,t){t=t||!1,i.channel("drawer").request("load:drawerContent",e,t);var n=i.channel("app").request("get:builderEl");jQuery(n).addClass("nf-drawer-opened").removeClass("nf-drawer-closed");var r=i.channel("app").request("get:drawerEl");jQuery(r).css({right:"0px"});var a=this;this.checkOpenDrawerPos=setInterval(function(){"0px"==jQuery(r).css("right")&&(clearInterval(a.checkOpenDrawerPos),a.focusFilter(),i.channel("app").request("update:currentDrawer",e),i.channel("drawer").trigger("opened"))},150)},toggleDrawerSize:function(){var e=i.channel("app").request("get:drawerEl");jQuery(e).toggleClass("nf-drawer-expand")},focusFilter:function(){var e=i.channel("drawer").request("get:filterEl");jQuery(e).focus()},getClosedDrawerPos:function(){var e=i.channel("app").request("get:builderEl"),t=jQuery(e).width()+300;return"-"+t+"px"},maybePreventClose:function(){return 0==Object.keys(this.objPreventClose).length?!1:!0},preventClose:function(e){this.objPreventClose[e]=!0},enableClose:function(e){delete this.objPreventClose[e]},filterFocused:function(){clearInterval(this.checkOpenDrawerPos)}});return e}),n("models/app/drawerModel",["views/app/drawer/headerDefault"],function(e){var t=Backbone.Model.extend({defaults:{getHeaderView:function(t){return new e(t)}}});return t}),n("models/app/drawerCollection",["models/app/drawerModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("views/fields/drawer/stagedField",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-drawer-staged-field",onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},events:{"click .dashicons-dismiss":"removeStagedField"},removeStagedField:function(e){i.channel("drawer-addField").trigger("click:removeStagedField",e,this.model)}});return e}),n("views/fields/drawer/stagingEmpty",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-drawer-staged-fields-empty",onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)}});return e}),n("views/fields/drawer/stagingCollection",["views/fields/drawer/stagedField","views/fields/drawer/stagingEmpty"],function(e,t){var n=Marionette.CollectionView.extend({tagName:"div",childView:e,emptyView:t,initialize:function(){i.channel("app").reply("get:stagedFieldsEl",this.getStagedFieldsEl,this)},onShow:function(){this.$el=jQuery(this.el).parent(),jQuery(this.$el).find("span:first").unwrap(),this.setElement(this.$el);jQuery(this.el).sortable({placeholder:"nf-staged-fields-sortable-placeholder",helper:"clone",tolerance:"pointer",over:function(e,t){i.channel("drawer-addField").trigger("over:stagedFields",e,t)},out:function(e,t){i.channel("drawer-addField").trigger("out:stagedFields",t)},receive:function(e,t){i.channel("drawer-addField").trigger("receive:stagedFields",t)},update:function(e,t){i.channel("fields").request("sort:staging")},start:function(e,t){i.channel("drawer-addField").trigger("start:stagedFields",t)},stop:function(e,t){i.channel("drawer-addField").trigger("stop:stagedFields",t)}}),jQuery(this.el).parent().draggable({opacity:.9,connectToSortable:".nf-fields-sortable",helper:function(e){var t=jQuery(e.target).parent().width(),n=jQuery(e.target).parent().height(),i=jQuery(e.target).parent().clone(),r=t/4,a=n/2;return jQuery(this).draggable("option","cursorAt",{top:a,left:r}),i},start:function(e,t){i.channel("drawer-addField").trigger("startDrag:fieldStaging",this,t)},stop:function(e,t){i.channel("drawer-addField").trigger("stopDrag:fieldStaging",this,t)}})},getStagedFieldsEl:function(){return jQuery(this.el)}});return n}),n("models/fields/stagingModel",[],function(){var e=Backbone.Model.extend({});return e}),n("models/fields/stagingCollection",["models/fields/stagingModel"],function(e){var t=Backbone.Collection.extend({model:e,comparator:"order"});return t}),n("views/fields/drawer/typeSection",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-drawer-field-type-section",initialize:function(){_.bindAll(this,"render")},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el),this.dragging=!1;var e=this;jQuery(this.el).find("div.nf-one-third").draggable({opacity:.9,tolerance:"intersect",scroll:!1,connectToSortable:".nf-field-type-droppable",helper:function(e){var t=jQuery(e.target).parent().width(),n=jQuery(e.target).parent().height(),i=jQuery(e.target).parent().clone(),r=t/4,a=n/2;return jQuery(this).draggable("option","cursorAt",{top:a,left:r}),i},start:function(t,n){e.dragging=!0,i.channel("drawer-addField").trigger("startDrag:type",this,n)},stop:function(t,n){e.dragging=!1,i.channel("drawer-addField").trigger("stopDrag:type",this,n)}}).disableSelection(),jQuery(this.el).find(".nf-item").focus(function(){jQuery(this).addClass("active")}).blur(function(){jQuery(this).removeClass("active")})},events:{"click .nf-item":"clickFieldType","keydown .nf-item":"maybeClickFieldType"},clickFieldType:function(e){this.dragging||i.channel("drawer").trigger("click:fieldType",e)},maybeClickFieldType:function(e){13==e.keyCode&&(this.clickFieldType(e),i.channel("drawer").request("clear:filter"))},templateHelpers:function(){return{renderFieldTypes:function(){var e="",t=this;return _.each(this.fieldTypes,function(n){var r=i.channel("fields").request("get:type",n),a=r.get("nicename");e+=_.template(jQuery("#nf-tmpl-drawer-field-type-button").html(),{id:n,nicename:a,type:r,savedField:t.isSavedField})}),e},isSavedField:function(){return this.type.get("savedField")?"nf-saved":""}}}});return e}),n("views/fields/drawer/typeSectionCollection",["views/fields/drawer/typeSection"],function(e){var t=Marionette.CollectionView.extend({tagName:"div",childView:e,onShow:function(){jQuery(this.el).find(".nf-settings").unwrap()}});return t}),n("views/fields/drawer/addField",["views/fields/drawer/stagingCollection","models/fields/stagingCollection","views/fields/drawer/typeSectionCollection"],function(e,t,n){var r=Marionette.LayoutView.extend({template:"#nf-tmpl-drawer-content-add-field",regions:{staging:"#nf-drawer-staging .nf-reservoir",primary:"#nf-drawer-primary",secondary:"#nf-drawer-secondary"},initialize:function(){this.listenTo(i.channel("drawer"),"filter:fieldTypes",this.filterFieldTypes),this.listenTo(i.channel("drawer"),"clear:filter",this.removeFieldTypeFilter),this.savedCollection=i.channel("drawer").request("get:savedFields"),this.primaryCollection=this.savedCollection,this.fieldTypeSectionCollection=i.channel("fields").request("get:typeSections"),this.secondaryCollection=this.fieldTypeSectionCollection},onShow:function(){var t=i.channel("fields").request("get:staging");this.staging.show(new e({collection:t})),this.primary.show(new n({collection:this.primaryCollection})),this.secondary.show(new n({collection:this.secondaryCollection}))},getEl:function(){return jQuery(this.el).parent()},filterFieldTypes:function(e){this.primary.reset(),this.secondary.reset(),this.filteredSectionCollection=e,this.primary.show(new n({collection:this.filteredSectionCollection}))},removeFieldTypeFilter:function(){this.primary.show(new n({collection:this.savedCollection})),this.secondary.show(new n({collection:this.fieldTypeSectionCollection}))}});return r}),n("views/app/drawer/itemSettingCollection",[],function(){var e=Marionette.CollectionView.extend({tagName:"div",initialize:function(e){this.childViewOptions={dataModel:e.dataModel}},getChildView:function(e){return i.channel("app").request("get:settingChildView",e)}});return e}),n("views/app/drawer/itemSettingGroup",["views/app/drawer/itemSettingCollection"],function(e){var t=Marionette.LayoutView.extend({tagName:"div",template:"#nf-tmpl-drawer-content-edit-field-setting-group",regions:{settings:".nf-field-settings"},initialize:function(e){this.model.on("change",this.render,this),this.dataModel=e.dataModel},onBeforeDestroy:function(){this.model.off("change",this.render)},onRender:function(){this.model.get("display")?this.settings.show(new e({collection:this.model.get("settings"),dataModel:this.dataModel})):this.settings.empty(),i.channel("drawer").trigger("render:settingGroup",this)},events:{"click .toggle":"clickToggleGroup"},clickToggleGroup:function(e){i.channel("drawer").trigger("click:toggleSettingGroup",e,this.model)},templateHelpers:function(){return{renderLabel:function(){return""!=this.label?_.template(jQuery("#nf-tmpl-drawer-content-edit-setting-group-label").html(),this):""},renderArrowDir:function(){return this.display?"down":"right"}}}});return t}),n("views/app/drawer/itemSettingGroupCollection",["views/app/drawer/itemSettingGroup"],function(e){var t=Marionette.CollectionView.extend({tagName:"div",childView:e,initialize:function(e){this.childViewOptions={dataModel:e.dataModel}}});return t}),n("views/app/drawer/editSettings",["views/app/drawer/itemSettingGroupCollection"],function(e){var t=Marionette.LayoutView.extend({tagName:"div",template:"#nf-tmpl-drawer-content-edit-settings",regions:{settingGroups:".nf-settings-groups"},initialize:function(e){this.dataModel=e.model,this.groupCollection=e.groupCollection},onRender:function(){this.settingGroups.show(new e({collection:this.groupCollection,dataModel:this.dataModel}))},templateHelpers:function(){return{maybeRenderTitle:function(){return"undefined"!=typeof this.type?_.template(jQuery("#nf-tmpl-drawer-content-edit-settings-title").html(),this):""},renderTypeNicename:function(){var e=i.channel("app").request("get:currentDomain"),t=e.get("id"),n=i.channel(t).request("get:type",this.type);return n.get("nicename")}}}});return t}),n("views/actions/drawer/typeButton",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-drawer-action-type-button",onRender:function(){if(this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el),jQuery(this.el).disableSelection(),"installed"==this.model.get("section")){var e=this;jQuery(this.el).draggable({opacity:.9,tolerance:"intersect",scroll:!1,helper:"clone",start:function(t,n){e.dragging=!0,i.channel("drawer-addAction").trigger("startDrag:type",this,n)},stop:function(t,n){e.dragging=!1,i.channel("drawer-addAction").trigger("stopDrag:type",this,n)}})}},events:{"click .nf-item":"clickAddAction"},clickAddAction:function(e){this.dragging||("installed"==this.model.get("section")?i.channel("actions").trigger("click:addAction",this.model):window.open(this.model.get("link"),"_blank"))},templateHelpers:function(){return{renderClasses:function(){var e="nf-item";return""!=jQuery.trim(this.image)&&(e+=" nf-has-img"),"installed"==this.section&&(e+=" nf-action-type"),e},renderStyle:function(){return""!=jQuery.trim(this.image)?'style="background-image: url('+this.image+');"':""}}}});return e}),n("views/actions/drawer/typeCollection",["views/actions/drawer/typeButton"],function(e){var t=Marionette.CompositeView.extend({template:"#nf-tmpl-drawer-action-type-section",childView:e,templateHelpers:function(){var e=this;return{renderNicename:function(){return e.collection.nicename},renderClasses:function(){return e.collection.slug}}},attachHtml:function(e,t){jQuery(e.el).find(".action-types").append(t.el)}});return t}),n("views/actions/drawer/addAction",["views/actions/drawer/typeCollection"],function(e){var t=Marionette.LayoutView.extend({template:"#nf-tmpl-drawer-content-add-action",regions:{primary:"#nf-drawer-primary",secondary:"#nf-drawer-secondary"},initialize:function(){this.listenTo(i.channel("drawer"),"filter:actionTypes",this.filteractionTypes),this.listenTo(i.channel("drawer"),"clear:filter",this.removeactionTypeFilter),this.installedActions=i.channel("actions").request("get:installedActions"),this.primaryCollection=this.installedActions,this.availableActions=i.channel("actions").request("get:availableActions"),this.secondaryCollection=this.availableActions},onShow:function(){this.primary.show(new e({collection:this.primaryCollection})),this.secondary.show(new e({collection:this.secondaryCollection}))},getEl:function(){return jQuery(this.el).parent()},filteractionTypes:function(t,n){this.primary.reset(),this.secondary.reset(),this.primary.show(new e({collection:t})),this.secondary.show(new e({collection:n}))},removeactionTypeFilter:function(){this.primary.show(new e({collection:this.installedActions})),this.secondary.show(new e({collection:this.availableActions}))}});return t}),n("views/settings/drawer/editFormSettings",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-drawer-content-edit-form-settings"});return e}),n("views/app/drawer/contentViewChangesItem",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-drawer-content-view-changes-item",initialize:function(){this.model.on("change:disabled",this.render,this)},onBeforeDestroy:function(){this.model.off("change:disabled",this.render)},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},events:{"click .undoSingle":"undoSingle"},undoSingle:function(e){i.channel("drawer").trigger("click:undoSingle",this.model)}});return e}),n("views/app/drawer/contentViewChanges",["views/app/drawer/contentViewChangesItem"],function(e){var t=Marionette.CollectionView.extend({tagName:"table",className:"nf-changes",childView:e});return t}),n("views/app/drawer/headerViewChanges",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-drawer-header-view-changes",events:{"click .undoChanges":"clickUndoChanges"},clickUndoChanges:function(e){i.channel("drawer").trigger("click:undoChanges")}});return e}),n("controllers/app/drawerConfig",["models/app/drawerCollection","views/fields/drawer/addField","views/app/drawer/editSettings","views/actions/drawer/addAction","views/settings/drawer/editFormSettings","views/app/drawer/contentViewChanges","views/app/drawer/headerViewChanges"],function(e,t,n,r,a,l,o){var s=Marionette.Object.extend({initialize:function(){this.collection=new e([{id:"addField",getContentView:function(e){return new t(e)}},{id:"addAction",getContentView:function(e){return new r(e)}},{id:"editSettings",getContentView:function(e){return new n(e)}},{id:"editFormSettings",getContentView:function(e){return new a(e)}},{id:"viewChanges",getHeaderView:function(e){return new o(e)},getContentView:function(e){return new l(e)}}]),i.channel("app").reply("get:drawerCollection",this.getDrawerCollection,this),i.channel("app").reply("get:drawer",this.getDrawer,this)},getDrawerCollection:function(){return this.collection},getDrawer:function(e){return this.collection.get(e)}});return s}),n("models/app/domainModel",[],function(){var e=Backbone.Model.extend({defaults:{dashicons:"",classes:"",active:!1,url:"",hotkeys:!1,disabled:!1}});return e}),n("models/app/domainCollection",["models/app/domainModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("views/fields/mainHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-main-header-fields",initialize:function(){var e=i.channel("fields").request("get:collection");this.listenTo(e,"add",this.render),this.listenTo(e,"remove",this.render)},onRender:function(){var e=i.channel("fields").request("get:collection");0==e.models.length?jQuery(this.el).hide():jQuery(this.el).show()}});return e}),n("views/fields/subHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-sub-header-fields"});return e}),n("views/app/itemControls",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-item-controls",initialize:function(){},onRender:function(){this.currentDomain=i.channel("app").request("get:currentDomain")},events:{"click .nf-edit-settings":"clickEdit","click .nf-delete":"clickDelete","click .nf-duplicate":"clickDuplicateField"},clickEdit:function(e){i.channel("app").trigger("click:edit",e,this.model)},clickDelete:function(e){i.channel("app").trigger("click:delete",e,this.model)},clickDuplicateField:function(e){i.channel("app").trigger("click:duplicate",e,this.model)}});return e}),n("views/fields/fieldItem",["views/app/itemControls"],function(e){var t=Marionette.LayoutView.extend({tagName:"div",template:"#nf-tmpl-main-content-field",regions:{itemControls:".nf-item-controls"},initialize:function(){this.model.on("change",this.render,this)},onBeforeDestroy:function(){this.model.off("change",this.render)},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el),this.itemControls.show(new e({model:this.model}))},templateHelpers:function(){return{renderClasses:function(){var e="nf-field-wrap";return this.editActive&&(e+=" active"),e},renderRequired:function(){return 1==this.required?'<span class="required">*</span>':""},getFieldID:function(){return jQuery.isNumeric(this.id)?"field-"+this.id:this.id}}},events:{click:"maybeClickEdit"},maybeClickEdit:function(e){jQuery(e.target).parent().hasClass("nf-fields-sortable")&&i.channel("app").trigger("click:edit",e,this.model)}});return t}),n("views/fields/mainContentEmpty",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-main-content-fields-empty",onBeforeDestroy:function(){jQuery(this.el).parent().removeClass("nf-fields-empty-droppable").droppable("destroy")},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},onShow:function(){jQuery(this.el).parent().hasClass("ui-sortable")&&jQuery(this.el).parent().sortable("destroy"),jQuery(this.el).parent().addClass("nf-fields-empty-droppable"),jQuery(this.el).parent().droppable({accept:function(e){return jQuery(e).hasClass("nf-stage")||jQuery(e).hasClass("nf-field-type-button")?!0:void 0},hoverClass:"nf-droppable-hover",tolerance:"pointer",over:function(e,t){t.item=t.draggable,i.channel("app").request("over:fieldsSortable",t)},out:function(e,t){t.item=t.draggable,i.channel("app").request("out:fieldsSortable",t)},drop:function(e,t){t.item=t.draggable,i.channel("app").request("receive:fieldsSortable",t);var n=i.channel("fields").request("get:collection");
n.trigger("reset",n)}})}});return e}),n("views/fields/mainContentFieldCollection",["views/fields/fieldItem","views/fields/mainContentEmpty"],function(e,t){var n=Marionette.CollectionView.extend({tagName:"div",childView:e,emptyView:t,reorderOnSort:!0,initialize:function(){i.channel("fields").reply("get:sortableEl",this.getSortableEl,this)},onRender:function(){if(this.collection.models.length>0){jQuery(this.el).addClass("nf-field-type-droppable").addClass("nf-fields-sortable");jQuery(this.el).sortable({containment:"#nf-main",helper:"clone",cancel:".nf-item-controls",placeholder:"nf-fields-sortable-placeholder",opacity:.95,tolerance:"intersect",receive:function(e,t){i.channel("app").request("receive:fieldsSortable",t)},over:function(e,t){i.channel("app").request("over:fieldsSortable",t)},out:function(e,t){i.channel("app").request("out:fieldsSortable",t)},start:function(e,t){i.channel("app").request("start:fieldsSortable",t)},update:function(e,t){i.channel("app").request("update:fieldsSortable",t)},stop:function(e,t){i.channel("app").request("stop:fieldsSortable",t)}})}},getSortableEl:function(){return this.el}});return n}),n("views/actions/mainHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-main-header-actions",initialize:function(){var e=i.channel("actions").request("get:collection");this.listenTo(e,"add",this.render),this.listenTo(e,"remove",this.render)},onRender:function(){var e=i.channel("actions").request("get:collection");0==e.models.length?jQuery(this.el).hide():jQuery(this.el).show()}});return e}),n("views/actions/subHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-sub-header-actions"});return e}),n("views/actions/actionItem",["views/app/itemControls"],function(e){var t=Marionette.LayoutView.extend({tagName:"tr",template:"#nf-tmpl-action-item",regions:{itemControls:".nf-item-controls"},initialize:function(){this.model.on("change",this.render,this)},onBeforeDestroy:function(){this.model.off("change",this.render)},onRender:function(){this.model.get("editActive")?jQuery(this.el).addClass("active"):jQuery(this.el).removeClass("active"),0==this.model.get("active")?jQuery(this.el).addClass("deactivated"):jQuery(this.el).removeClass("deactivated"),this.itemControls.show(new e({model:this.model}))},events:{"change input":"changeToggle",click:"maybeClickEdit"},maybeClickEdit:function(e){"TR"==jQuery(e.target).parent().prop("tagName")&&i.channel("app").trigger("click:edit",e,this.model)},changeToggle:function(e){var t=i.channel("actions").request("get:settingModel","active");i.channel("app").request("change:setting",e,t,this.model),i.channel("app").request("update:db")},templateHelpers:function(){return{renderToggle:function(){var e=this.label;this.label="",this.value=this.active,this.name=this.id+"-active";var t=_.template(jQuery("#nf-tmpl-edit-setting-toggle").html(),this);return this.label=e,t},renderTypeNicename:function(){var e=i.channel("actions").request("get:type",this.type);return e.get("nicename")},renderTooltip:function(){return this.help?'<a class="nf-help" href="#"><span class="dashicons dashicons-admin-comments"></span></a><div class="nf-help-text">'+this.help+"</div>":""},renderMergeTags:function(){return this.use_merge_tags?'<span class="dashicons dashicons-list-view merge-tags"></span>':""}}}});return t}),n("views/actions/mainContentEmpty",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-main-content-actions-empty",onBeforeDestroy:function(){jQuery(this.el).parent().parent().removeClass("nf-actions-empty")},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},onShow:function(){jQuery(this.el).parent().parent().addClass("nf-actions-empty")}});return e}),n("views/actions/mainContent",["views/actions/actionItem","views/actions/mainContentEmpty"],function(e,t){var n=Marionette.CompositeView.extend({template:"#nf-tmpl-action-table",childView:e,emptyView:t,onRender:function(){jQuery(this.el).droppable({accept:".nf-one-third",activeClass:"nf-droppable-active",hoverClass:"nf-droppable-hover",drop:function(e,t){i.channel("app").request("drop:actionType",e,t)}})},attachHtml:function(e,t){jQuery(e.el).find("tbody").append(t.el)}});return n}),n("views/settings/mainHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-main-header-settings"});return e}),n("views/settings/subHeader",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-sub-header-settings"});return e}),n("views/settings/settingItem",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-form-setting-type",onBeforeDestroy:function(){this.model.off("change:editActive",this.render)},initialize:function(){this.model.on("change:editActive",this.render,this)},events:{click:"clickEdit"},clickEdit:function(e){i.channel("settings").trigger("click:edit",e,this.model)},templateHelpers:function(){return{renderClasses:function(){var e="nf-setting-wrap";return this.editActive&&(e+=" active"),e}}}});return e}),n("views/settings/mainContent",["views/settings/settingItem"],function(e){var t=Marionette.CollectionView.extend({childView:e});return t}),n("controllers/app/domainConfig",["models/app/domainCollection","views/fields/mainHeader","views/fields/subHeader","views/fields/mainContentFieldCollection","views/actions/mainHeader","views/actions/subHeader","views/actions/mainContent","views/settings/mainHeader","views/settings/subHeader","views/settings/mainContent"],function(e,t,n,r,a,l,o,s,c,d){var h=Marionette.Object.extend({initialize:function(){this.collection=new e([{id:"fields",nicename:"Form Fields",hotkeys:{Esc:"close:drawer","Ctrl+Shift+n":"add:newField","Ctrl+Shift+a":"changeDomain:actions","Ctrl+Shift+s":"changeDomain:settings","Alt+Ctrl+t":"open:mergeTags",up:"up:mergeTags",down:"down:mergeTags","Shift+return":"return:mergeTags"},getMainHeaderView:function(){return new t},getSubHeaderView:function(){return new n},getMainContentView:function(e){var e=i.channel("fields").request("get:collection");return new r({collection:e})}},{id:"actions",nicename:"Emails & Actions",hotkeys:{Esc:"close:drawer","Ctrl+Shift+n":"add:newAction","Ctrl+Shift+f":"changeDomain:fields","Ctrl+Shift+s":"changeDomain:settings","Alt+Ctrl+t":"open:mergeTags",up:"up:mergeTags",down:"down:mergeTags","Shift+return":"return:mergeTags"},getMainHeaderView:function(){return new a},getSubHeaderView:function(){return new l},getMainContentView:function(){var e=i.channel("actions").request("get:collection");return new o({collection:e})}},{id:"settings",nicename:"Advanced",hotkeys:{Esc:"close:drawer","Ctrl+Shift+f":"changeDomain:fields","Ctrl+Shift+a":"changeDomain:actions","Alt+Ctrl+t":"open:mergeTags",up:"up:mergeTags",down:"down:mergeTags","Shift+return":"return:mergeTags"},getMainHeaderView:function(){return new s},getSubHeaderView:function(){return new c},getMainContentView:function(){var e=i.channel("settings").request("get:typeCollection");return new d({collection:e})}},{id:"preview",nicename:"Preview Form",classes:"preview",dashicons:"dashicons-visibility",url:nfAdmin.previewurl}]),i.channel("app").reply("get:domainCollection",this.getDomainCollection,this),i.channel("app").reply("get:domainModel",this.getDomainModel,this)},getDomainCollection:function(){return this.collection},getDomainModel:function(e){return this.collection.get(e)}});return h}),n("models/app/appModel",[],function(){var e=Backbone.Model.extend({defaults:{loading:!1},initialize:function(){this.on("change:clean",this.changeStatus,this)},changeStatus:function(){i.channel("app").trigger("change:clean",this.get("clean"))}});return e}),n("controllers/app/data",["models/app/appModel"],function(e){var t=Marionette.Object.extend({initialize:function(){var t=i.channel("app").request("get:domainCollection");this.model=new e({currentDrawer:!1,currentDomain:t.get("fields"),clean:!0}),i.channel("app").reply("get:data",this.getData,this),i.channel("app").reply("get:setting",this.getSetting,this),i.channel("app").reply("get:currentDomain",this.getCurrentDomain,this),i.channel("app").reply("get:currentDrawer",this.getCurrentDrawer,this),i.channel("app").reply("update:currentDomain",this.updateCurrentDomain,this),i.channel("app").reply("update:currentDrawer",this.updateCurrentDrawer,this),i.channel("app").reply("update:setting",this.updateSetting,this)},updateCurrentDomain:function(e){this.updateSetting("currentDomain",e)},updateSetting:function(e,t){return this.model.set(e,t),!0},getSetting:function(e){return this.model.get(e)},getData:function(){return this.model},getCurrentDomain:function(){return this.model.get("currentDomain")},updateCurrentDrawer:function(e){return this.updateSetting("currentDrawer",e),!0},getCurrentDrawer:function(){var e=this.model.get("currentDrawer");return i.channel("app").request("get:drawer",e)}});return t}),n("controllers/app/drawerToggleSettingGroup",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer"),"click:toggleSettingGroup",this.toggleSettingGroup)},toggleSettingGroup:function(e,t){t.get("display")?t.set("display",!1):t.set("display",!0)}});return e}),n("controllers/app/updateDB",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer"),"closed",this.updateDB),i.channel("app").reply("update:db",this.updateDB,this)},updateDB:function(e){if(i.channel("app").request("get:setting","clean"))return!1;if(e=e||"preview","preview"==e)var t="nf_preview_update";else if("publish"==e)var t="nf_save_form";var n=i.channel("app").request("get:formData"),r=JSON.parse(JSON.stringify(n)),a=n.get("fields").removedIDs;_.each(r.fields,function(e){var t=e.id;delete e.id,delete e.parent_id;var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i],delete e[i]);e.settings=n,e.id=t}),r.deleted_fields=a;var a=n.get("actions").removedIDs;_.each(r.actions,function(e){var t=e.id;delete e.id,delete e.parent_id;var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i],delete e[i]);e.settings=n,e.id=t}),r.deleted_actions=a,r=JSON.stringify(r),i.channel("app").trigger("before:updateDB",r),"publish"==e&&(i.channel("app").request("update:setting","loading",!0),i.channel("app").trigger("change:loading")),jQuery.post(ajaxurl,{action:t,form:r,security:nfAdmin.ajaxNonce},function(t){try{t=JSON.parse(t),t.action=e,i.channel("app").trigger("response:updateDB",t)}catch(n){console.log("Something went wrong!"),console.log(t)}})}});return e}),n("models/app/formModel",[],function(){var e=Backbone.Model.extend({});return e}),n("controllers/app/formData",["models/app/formModel"],function(e){var t=Marionette.Object.extend({initialize:function(){this.model=new e,this.model.set("id",preloadedFormData.id),this.model.set("fields",i.channel("fields").request("get:collection")),this.model.set("actions",i.channel("actions").request("get:collection")),this.model.set("settings",i.channel("settings").request("get:settings")),i.channel("app").reply("get:formData",this.getFormData,this)},getFormData:function(){return this.model}});return t}),n("controllers/app/previewLink",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"before:sendChanges",this.disablePreview,this),this.listenTo(i.channel("app"),"response:sendChanges",this.enablePreview,this),this.listenTo(i.channel("app"),"change:clean",this.changePreviewNicename,this)},disablePreview:function(){var e=i.channel("app").request("get:domainCollection"),t=e.get("preview");t.set("disabled",!0)},changePreviewNicename:function(e){var t=i.channel("app").request("get:domainCollection"),n=t.get("preview");if(e)var r="Preview Form";else var r="Preview Changes";n.set("nicename",r)},enablePreview:function(){var e=i.channel("app").request("get:domainCollection"),t=e.get("preview");t.set("disabled",!1)}});return e}),n("controllers/app/menuButtons",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"click:publish",this.publish),this.listenTo(i.channel("app"),"click:viewChanges",this.viewChanges)},publish:function(){i.channel("app").request("update:db","publish")},viewChanges:function(){var e=i.channel("changes").request("get:changeCollection");i.channel("app").request("open:drawer","viewChanges",{collection:e})}});return e}),n("models/app/changeModel",[],function(){var e=Backbone.Model.extend({defaults:{disabled:!1}});return e}),n("models/app/changeCollection",["models/app/changeModel"],function(e){var t=Backbone.Collection.extend({model:e,comparator:function(e){var t=parseInt(e.cid.replace("c",""));return-t}});return t}),n("controllers/app/trackChanges",["models/app/changeCollection","models/app/changeModel"],function(e,t){var n=Marionette.Object.extend({initialize:function(){this.collection=new e,i.channel("changes").reply("register:change",this.registerChange,this),i.channel("changes").reply("get:changeCollection",this.getCollection,this),this.listenTo(i.channel("app"),"change:clean",this.maybeResetCollection)},registerChange:function(e,n,i,r,a){var a="undefined"!=typeof a?a:{};"undefined"==typeof r.dashicon&&(r.dashicon="admin-generic");var l=new t({action:e,model:n,changes:i,label:r,data:a});return this.collection.add(l),l},getCollection:function(){return this.collection},maybeResetCollection:function(e){e&&this.collection.reset()}});return n}),n("controllers/app/undoChanges",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer"),"click:undoChanges",this.undoChanges,this),this.listenTo(i.channel("drawer"),"click:undoSingle",this.undoSingle,this)},undoChanges:function(){var e=i.channel("changes").request("get:changeCollection");e.sort();var t=this;_.each(e.models,function(e){t.undoSingle(e,!0)}),e.reset(),i.channel("app").request("update:db"),i.channel("app").request("update:setting","clean",!0),i.channel("app").request("close:drawer")},undoSingle:function(e,t){i.channel("changes").request("undo:"+e.get("action"),e,t)}});return e}),n("controllers/app/publishResponse",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"response:updateDB",this.publishResponse)},publishResponse:function(e){return"publish"!==e.action?!1:("undefined"!=typeof e.data.new_ids&&("undefined"!=typeof e.data.new_ids.fields&&_.each(e.data.new_ids.fields,function(e,t){var n=i.channel("fields").request("get:field",t);n&&n.set("id",e)}),"undefined"!=typeof e.data.new_ids.actions&&_.each(e.data.new_ids.actions,function(e,t){var n=i.channel("actions").request("get:action",t);n&&n.set("id",e)})),i.channel("app").request("update:setting","loading",!1),i.channel("app").trigger("change:loading"),void i.channel("app").request("update:setting","clean",!0))}});return e}),n("controllers/app/changeDomain",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"click:menu",this.changeAppDomain),i.channel("app").reply("change:currentDomain",this.changeAppDomain,this)},changeAppDomain:function(e,t){if("undefined"==typeof t)var n=jQuery(e.target).data("domain"),t=i.channel("app").request("get:domainModel",n);i.channel("app").request("get:currentDrawer")&&i.channel("app").request("close:drawer"),0==t.get("url").length&&(i.channel("app").request("update:currentDomain",t),i.channel("app").trigger("change:currentDomain",t))}});return e}),n("controllers/app/pushstate",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"change:currentDomain",this.changePushState)},changePushState:function(){var e=i.channel("app").request("get:currentDomain");history.pushState(null,null,window.location.href+"&domain="+e.get("id"));var t=/domain=\\d+/,n=window.location.toString(),r=n.replace(t,"");console.log(r)}});return e}),n("controllers/app/hotkeys",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("main"),"render:main",this.changeHotkeys),this.listenTo(i.channel("drawer"),"opened",this.changeHotkeys),this.listenTo(i.channel("drawer"),"render:settingGroup",this.changeHotkeys),this.listenTo(i.channel("hotkeys"),"add:newField",this.addNewField),this.listenTo(i.channel("hotkeys"),"add:newAction",this.addNewAction),this.listenTo(i.channel("hotkeys"),"changeDomain:fields",this.changeDomainFields),this.listenTo(i.channel("hotkeys"),"changeDomain:actions",this.changeDomainActions),this.listenTo(i.channel("hotkeys"),"changeDomain:settings",this.changeDomainSettings),this.listenTo(i.channel("hotkeys"),"close:drawer",this.closeDrawer)},changeHotkeys:function(){var e=i.channel("app").request("get:currentDomain");jQuery(document).off(".nfDomainHotkeys"),jQuery("input").off(".nfDomainHotkeys"),e.get("hotkeys")&&jQuery.each(e.get("hotkeys"),function(e,t){jQuery(document).on("keydown.nfDomainHotkeys",null,e,function(e){i.channel("hotkeys").trigger(t,e)}),jQuery("input").on("keydown.nfDomainHotkeys",null,e,function(e){i.channel("hotkeys").trigger(t,e)}),jQuery("textarea").on("keydown.nfDomainHotkeys",null,e,function(e){i.channel("hotkeys").trigger(t,e)})})},addNewField:function(){"addField"!=i.channel("app").request("get:currentDrawer")?i.channel("app").request("open:drawer","addField"):i.channel("app").request("close:drawer")},addNewAction:function(){"addAction"!=i.channel("app").request("get:currentDrawer")?i.channel("app").request("open:drawer","addAction"):i.channel("app").request("close:drawer")},changeDomainFields:function(){var e=i.channel("app").request("get:domainCollection"),t=e.get("fields");i.channel("app").request("change:currentDomain",{},t)},changeDomainActions:function(){var e=i.channel("app").request("get:domainCollection"),t=e.get("actions");i.channel("app").request("change:currentDomain",{},t)},changeDomainSettings:function(){var e=i.channel("app").request("get:domainCollection"),t=e.get("settings");i.channel("app").request("change:currentDomain",{},t)},closeDrawer:function(){i.channel("app").request("close:drawer")}});return e}),n("controllers/app/cleanState",[],function(){var e=Marionette.Object.extend({initialize:function(){this.ignoreAttributes=["editActive"],this.listenTo(i.channel("app"),"update:setting",this.setAppClean)},setAppClean:function(e){for(var t in e.changedAttributes())var n=t,r=e.changedAttributes()[t];i.channel("undo-"+e.get("type")).request("ignore:attributes",this.ignoreAttributes)||this.ignoreAttributes;return-1!=this.ignoreAttributes.indexOf(t)?!1:void i.channel("app").request("update:setting","clean",!1)}});return e}),n("controllers/app/coreUndo",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("changes").reply("undo:changeSetting",this.undoChangeSetting,this),i.channel("changes").reply("undo:addObject",this.undoAddObject,this),i.channel("changes").reply("undo:removeObject",this.undoRemoveObject,this),i.channel("changes").reply("undo:duplicateObject",this.undoDuplicateObject,this),i.channel("changes").reply("undo:sortFields",this.undoSortFields,this),i.channel("changes").reply("undo:addListOption",this.undoAddListOption,this),i.channel("changes").reply("undo:removeListOption",this.undoRemoveListOption,this),i.channel("changes").reply("undo:sortListOptions",this.undoSortListOptions,this)},undoChangeSetting:function(e,t){var n=e.get("model"),i=e.get("changes"),r=i.attr,a=i.before;n.set(r,a),this.maybeRemoveChange(e,t)},undoAddObject:function(e,t){var n=e.get("model"),r=e.get("data").collection;if(delete r.newIDs[n.get("id")],!t){var a=i.channel("changes").request("get:changeCollection"),l=a.where({model:n});_.each(l,function(t){t!==e&&a.remove(t)})}r.remove(n),this.maybeRemoveChange(e,t)},undoDuplicateObject:function(e,t){var n=e.get("model"),r=e.get("data").collection;if(!t){var a=i.channel("changes").request("get:changeCollection"),l=a.where({model:n});_.each(l,function(t){t!==e&&a.remove(t)})}r.remove(n),this.maybeRemoveChange(e,t)},undoRemoveObject:function(e,t){var n=e.get("model"),r=e.get("data").collection;if(i.channel(n.get("objectDomain")).request("add",n),delete r.removedIDs[n.get("id")],!t){var a=i.channel("changes").request("get:changeCollection"),l=a.where({model:n});_.each(l,function(t){t!==e&&t.set("disabled",!1)})}r.trigger("reset",r),this.maybeRemoveChange(e,t)},undoSortFields:function(e,t){var n=e.get("data"),r=n.fields,a=i.channel("fields").request("get:collection");_.each(r,function(e){var t=e.before,n=e.model;n.set("order",t),console.log("set "+n.get("label")+" to "+t)}),console.log(a.where({label:"Name"})),console.log(a.where({label:"Email"})),a.sort(),this.maybeRemoveChange(e,t)},undoAddListOption:function(e,t){var n=e.get("model");if(!t){var r=i.channel("changes").request("get:changeCollection"),a=r.where({model:n});_.each(a,function(t){t!==e&&r.remove(t)})}n.collection.remove(n),this.maybeRemoveChange(e,t)},undoRemoveListOption:function(e,t){var n=e.get("model"),r=e.get("data").collection;if(r.add(n),!t){var a=i.channel("changes").request("get:changeCollection"),l=a.where({model:n});_.each(l,function(t){t!==e&&t.set("disabled",!1)})}this.maybeRemoveChange(e,t)},undoSortListOptions:function(e,t){var n=e.get("data"),i=n.collection,r=n.objModels;_.each(r,function(e){var t=e.before,n=e.model;n.set("order",t)}),i.sort(),this.maybeRemoveChange(e,t)},maybeRemoveChange:function(e,t){var t="undefined"!=typeof t?t:!1;if(!t){i.channel("app").request("update:db");var n=i.channel("changes").request("get:changeCollection");n.remove(e),0==n.length&&(i.channel("app").request("update:setting","clean",!0),i.channel("app").request("close:drawer"))}}});return e}),n("controllers/app/cloneModelDeep",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("app").reply("clone:modelDeep",this.cloneModelDeep,this)},cloneModelDeep:function(e){var t={};_.each(e.attributes,function(e,n){if(e instanceof Backbone.Collection){var i=e.map(function(e){return e.clone()}),r=_.clone(e.options),a=new e.constructor(i,r);t[n]=a}else e instanceof Backbone.Model&&(t[n]=e.clone())});var n=e.clone();return _.each(t,function(e,t){n.set(t,e)}),n}});return e}),n("views/app/drawer/itemSetting",["views/app/drawer/mergeTagsContent"],function(e){var t=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-edit-setting-wrap",initialize:function(e){this.dataModel=e.dataModel},onBeforeRender:function(){i.channel("app").trigger("before:renderSetting",this.model,this.dataModel)},onRender:function(){this.mergeTagsContentView=!1;var e=this;jQuery(this.el).find(".nf-help").each(function(){var e=jQuery(this).next(".nf-help-text");jQuery(this).jBox("Tooltip",{content:e,maxWidth:200,theme:"TooltipBorder",trigger:"click",closeOnClick:!0})}),jQuery(this.el).find(".merge-tags").each(function(){jQuery(this).jBox("Tooltip",{title:"Insert Merge Tag",content:jQuery(".merge-tags-content"),trigger:"click",position:{x:"center",y:"bottom"},closeOnClick:"body",closeOnEsc:!0,theme:"TooltipBorder",maxHeight:200,onOpen:function(){var t=jQuery(e.el).find(".setting");i.channel("mergeTags").request("update:currentElement",t),i.channel("mergeTags").request("update:open",!0),i.channel("drawer").request("prevent:close","merge-tags")},onCloseComplete:function(){i.channel("mergeTags").request("update:open",!1),i.channel("drawer").request("enable:close","merge-tags")}})})},onShow:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},templateHelpers:function(){var e=this;return{renderSetting:function(){return"undefined"!=typeof e.dataModel.get(this.name)?this.value=e.dataModel.get(this.name):this.value="",_.template(jQuery("#nf-tmpl-edit-setting-"+this.type).html(),this)},renderLabelClasses:function(){return"has-merge-tags"},renderWidth:function(){return"undefined"!=typeof this.width?this.width:"one-half"},renderTooltip:function(){return this.help?'<a class="nf-help" href="#"><span class="dashicons dashicons-admin-comments"></span></a><div class="nf-help-text">'+this.help+"</div>":""},renderMergeTags:function(){return this.use_merge_tags?'<span class="dashicons dashicons-list-view merge-tags"></span>':""}}},events:{change:"changeSetting"},changeSetting:function(e){i.channel("app").trigger("change:setting",e,this.model,this.dataModel)}});return t}),n("controllers/app/getSettingChildView",["views/app/drawer/itemSetting"],function(e){var t=Marionette.Object.extend({initialize:function(){i.channel("app").reply("get:settingChildView",this.getSettingChildView,this)},getSettingChildView:function(t){var n=t.get("type"),r=i.channel(n).request("get:settingChildView",t)||e;return r}});return t}),n("controllers/app/changeSettingDefault",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("app").reply("change:setting",this.changeSetting,this),this.listenTo(i.channel("app"),"change:setting",this.changeSetting,this)},changeSetting:function(e,t,n){var r=t.get("name"),a=n.get(r),l=i.channel(t.get("type")).request("before:updateSetting",e,n,r,t);"undefined"==typeof l&&(l=jQuery(e.target).val()),n.set(r,l);var o=l,s={attr:r,before:a,after:o},c=i.channel("app").request("get:currentDomain"),d=c.get("id"),t=i.channel(d).request("get:settingModel",r);"toggle"==t.get("type")&&(a=1==a?"On":"Off",o=1==o?"On":"Off");var h={object:n.get("objectType"),label:n.get("label"),change:"Changed "+t.get("label")+" from "+a+" to "+o};i.channel("changes").request("register:change","changeSetting",n,s,h)}});return e}),n("views/app/drawer/typeSettingFieldset",["views/app/drawer/itemSetting"],function(e){var t=Marionette.CompositeView.extend({template:"#nf-tmpl-edit-setting-wrap",childView:e,initialize:function(e){this.collection=this.model.get("settings"),this.childViewOptions={dataModel:e.dataModel}},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el),this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},templateHelpers:function(){return{renderSetting:function(){return _.template(jQuery("#nf-tmpl-edit-setting-"+this.type).html(),this)},renderWidth:function(){return"undefined"!=typeof this.width?this.width:"one-half"}}},attachHtml:function(e,t){jQuery(e.el).find(".nf-field-sub-settings").append(t.el)}});return t}),n("models/app/settingModel",[],function(){var e=Backbone.Model.extend({defaults:{settings:!1},initialize:function(){i.channel("app").trigger("init:settingModel",this),"undefined"==typeof this.get("type"),i.channel(this.get("type")).trigger("init:settingModel",this)}});return e}),n("models/app/settingCollection",["models/app/settingModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("controllers/app/fieldset",["views/app/drawer/typeSettingFieldset","models/app/settingCollection"],function(e,t){var n=Marionette.Object.extend({initialize:function(){i.channel("fieldset").reply("get:settingChildView",this.getSettingChildView,this),this.listenTo(i.channel("fieldset"),"init:settingModel",this.createSettingsCollection)},getSettingChildView:function(t){return e},createSettingsCollection:function(e){e.set("settings",new t(e.get("settings")))}});return n}),n("controllers/app/toggleSetting",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("toggle").reply("before:updateSetting",this.updateSetting,this)},updateSetting:function(e,t,n,i){if(jQuery(e.target).attr("checked"))var r=1;else var r=0;return r}});return e}),n("controllers/app/itemControls",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"click:edit",this.clickEdit),this.listenTo(i.channel("app"),"click:delete",this.clickDelete),this.listenTo(i.channel("app"),"click:duplicate",this.clickDuplicate)},clickEdit:function(e,t){var n=i.channel("app").request("get:currentDomain"),r=n.get("id");i.channel(r).request("clear:editActive"),t.set("editActive",!0);var a=i.channel(r).request("get:type",t.get("type"));i.channel("app").request("open:drawer","editSettings",{model:t,groupCollection:a.get("settingGroups")})},clickDelete:function(e,t){var n=i.channel("app").request("clone:modelDeep",t),r={object:t.get("objectType"),label:t.get("label"),change:"Removed",dashicon:"dismiss"},a={collection:t.collection},l=i.channel("changes").request("get:changeCollection"),o=l.where({model:t});_.each(o,function(e){var i=e.get("data");"undefined"!=typeof i.fields&&_.each(i.fields,function(e,r){e.model==t&&(i.fields[r].model=n)}),e.set("data",i),e.set("model",n),e.set("disabled",!0)}),i.channel("changes").request("register:change","removeObject",n,null,r,a);var s=i.channel("app").request("get:currentDomain"),c=s.get("id");i.channel(c).request("delete",t)},clickDuplicate:function(e,t){var n=i.channel("app").request("clone:modelDeep",t),r=i.channel("app").request("get:currentDomain"),a=r.get("id");n.set("label",n.get("label")+" Copy");var l=i.channel(a).request("get:tmpID");n.set("id",l),i.channel(a).request("add",n);var o={object:t.get("objectType"),label:t.get("label"),change:"Duplicated",dashicon:"admin-page"},s={collection:i.channel(a).request("get:collection")};i.channel("changes").request("register:change","duplicateObject",n,null,o,s),i.channel("app").request("update:db")}});return e}),n("models/app/mergeTagModel",[],function(){var e=Backbone.Model.extend({defaults:{active:!1}});return e}),n("models/app/mergeTagCollection",["models/app/mergeTagModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("controllers/app/mergeTags",["models/app/mergeTagCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.tagSectionCollection=new e;var t=this;_.each(mergeTags,function(n){if(n.tags)var i=new e(n.tags);else var i="";t.tagSectionCollection.add({id:n.id,label:n.label,tags:i})});var n=new e,r=i.channel("fields").request("get:collection");_.each(r.models,function(e){n.add({id:e.get("id"),label:e.get("label"),tag:"{field:"+e.get("id")+"}"})}),this.tagSectionCollection.get("fields").set("tags",n),this.currentElement={},this.open=!1,this.listenTo(i.channel("mergeTags"),"click:mergeTag",this.clickMergeTag),i.channel("mergeTags").reply("update:currentElement",this.updateCurrentElement,this),i.channel("mergeTags").reply("get:mergeTags",this.getMergeTags,this)},clickMergeTag:function(e,t){var n=jQuery(this.currentElement).val(),i=jQuery(this.currentElement).caret(),r=i+t.get("tag").length;n=n.substr(0,i)+t.get("tag")+n.substr(i),jQuery(this.currentElement).val(n).caret(r).trigger("change")},openMergeTags:function(e){("TEXTAREA"==jQuery(e.target)[0].tagName||"INPUT"==jQuery(e.target)[0].tagName)&&jQuery(e.target).parent().find(".merge-tags").click()},returnMergeTags:function(e){if(this.open){e.preventDefault();var t=this.fields.where({active:!0})[0];t&&this.clickMergeTag(e,t)}},upMergeTags:function(e){this.open&&(e.preventDefault(),this.changeActiveTag("up"))},downMergeTags:function(e){this.open&&(e.preventDefault(),this.changeActiveTag("down"))},changeActiveTag:function(e){if("down"==e)var t=1;else var t=-1;if(0<this.fields.where({active:!0}).length){var n=this.fields.where({active:!0})[0],i=this.fields.indexOf(n);n.set("active",!1);var r=this.fields.models[i+t];r&&r.set("active",!0)}else 0<this.fields.where({active:!0})?console.log("system"):0<this.userInfo.where({active:!0})?console.log("userinfo"):0<this.fields.models.length?this.fields.models[0].set("active",!0):this.system.models[0].set("active",!0)},updateCurrentElement:function(e){this.currentElement=e},getMergeTags:function(){return this.tagSectionCollection},updateOpen:function(e){this.open=e,_.each(this.tagSectionCollection.get("fields").models,function(e){e.set("active",!1)})}});return t}),n("controllers/app/itemSettingFill",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"before:renderSetting",this.beforeRenderSetting)},beforeRenderSetting:function(e,t){"fields"==e.get("fill")}});return e}),n("models/app/typeModel",[],function(){var e=Backbone.Model.extend({});return e}),n("models/app/typeCollection",["models/app/typeModel"],function(e){
var t=Backbone.Collection.extend({model:e});return t}),n("models/app/settingGroupModel",[],function(){var e=Backbone.Model.extend({defaults:{display:!1}});return e}),n("models/app/settingGroupCollection",["models/app/settingGroupModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("models/fields/typeSectionModel",[],function(){var e=Backbone.Model.extend({defaults:{classes:""}});return e}),n("models/fields/typeSectionCollection",["models/fields/typeSectionModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("controllers/fields/types",["models/app/typeCollection","models/app/settingCollection","models/app/settingGroupCollection","models/fields/typeSectionCollection"],function(e,t,n,r){var a=Marionette.Object.extend({initialize:function(){this.collection=new e,this.fieldTypeSections=new r(fieldTypeSections);var a=this;_.each(fieldTypeData,function(e){var i=new n;_.each(e.settingGroups,function(e){var n={label:e.label,display:e.display,settings:new t(e.settings)};i.add(n)}),"undefined"!=typeof a.fieldTypeSections.get(e.section)&&a.fieldTypeSections.get(e.section).get("fieldTypes").push(e.id);var r={id:e.id,nicename:e.nicename,alias:e.alias,parentType:e.parentType,settingGroups:i,settingDefaults:e.settingDefaults};a.collection.add(r)}),i.channel("fields").reply("get:type",this.getFieldType,this),i.channel("fields").reply("get:typeCollection",this.getTypeCollection,this),i.channel("fields").reply("get:typeSections",this.getTypeSections,this),this.listenTo(i.channel("drawer"),"click:fieldType",this.addStagedField)},getFieldType:function(e){return this.collection.get(e)},getTypeCollection:function(e){return this.collection},addStagedField:function(e){var t=jQuery(e.target).data("id");i.channel("fields").request("add:stagedField",t)},getTypeSections:function(){return this.fieldTypeSections}});return a}),n("controllers/fields/fieldTypeDrag",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addField"),"startDrag:type",this.startDrag),this.listenTo(i.channel("drawer-addField"),"stopDrag:type",this.stopDrag),i.channel("drawer-addField").reply("get:typeHelperClone",this.getCurrentDraggableHelperClone,this)},startDrag:function(e,t){this.drawerEl=i.channel("app").request("get:drawerEl"),this.mainEl=i.channel("app").request("get:mainEl"),jQuery(this.drawerEl)[0].style.setProperty("overflow","visible","important"),jQuery(this.mainEl)[0].style.setProperty("overflow","visible","important"),this.draggableHelperClone=jQuery(t.helper).clone()},stopDrag:function(e,t){jQuery(this.drawerEl)[0].style.setProperty("overflow","hidden","important"),jQuery(this.mainEl)[0].style.setProperty("overflow","hidden","important")},getCurrentDraggableHelperClone:function(){return this.draggableHelperClone}});return e}),n("controllers/fields/stagingDrag",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addField"),"startDrag:fieldStaging",this.startDrag),this.listenTo(i.channel("drawer-addField"),"stopDrag:fieldStaging",this.stopDrag)},startDrag:function(e,t){this.drawerEl=i.channel("app").request("get:drawerEl"),this.mainEl=i.channel("app").request("get:mainEl"),jQuery(this.drawerEl)[0].style.setProperty("overflow","visible","important"),jQuery(this.mainEl)[0].style.setProperty("overflow","visible","important");var n=i.channel("fields").request("get:staging"),r=_.template(jQuery("#nf-tmpl-staged-fields-drag").html(),{num:n.models.length});jQuery(t.helper).html(r),jQuery(t.helper).prop("id","nf-staged-fields-drag"),jQuery(t.item).css("opacity","0.7")},stopDrag:function(e,t){jQuery(this.drawerEl)[0].style.setProperty("overflow","hidden","important"),jQuery(this.mainEl)[0].style.setProperty("overflow","hidden","important")}});return e}),n("controllers/fields/savedFieldsSection",["models/fields/typeSectionCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.collection=new e([{id:"saved",nicename:"Saved Fields",classes:"nf-saved",fieldTypes:[]}]),i.channel("drawer").reply("get:savedFields",this.getSavedFields,this)},getSavedFields:function(){return this.collection}});return t}),n("controllers/fields/staging",["models/fields/stagingCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.collection=new e,i.channel("fields").reply("add:stagedField",this.addStagedField,this),i.channel("fields").reply("remove:stagedField",this.removeStagedField,this),i.channel("fields").reply("get:staging",this.getStagingCollection,this),i.channel("fields").reply("sort:staging",this.sortStagedFields,this),i.channel("fields").reply("clear:staging",this.clearStagedFields,this),this.listenTo(i.channel("drawer-addField"),"click:removeStagedField",this.removeStagedField),this.listenTo(i.channel("drawer-addField"),"before:closeDrawer",this.beforeCloseDrawer)},getStagingCollection:function(){return this.collection},addStagedField:function(e){var t=i.channel("fields").request("get:type",e),n="nf-staged-field-"+jQuery.now(),r={id:n,slug:t.get("id"),nicename:t.get("nicename")};return this.collection.add(r),n},removeStagedField:function(e,t){this.collection.remove(t)},beforeCloseDrawer:function(){if(0!=this.collection.models.length){var e=i.channel("fields").request("get:collection");_.each(this.collection.models,function(t){var n=i.channel("fields").request("get:tmpFieldID"),r={id:n,label:t.get("nicename"),type:t.get("slug")},a=i.channel("fields").request("add",r,!1),l={object:"Field",label:a.get("label"),change:"Added",dashicon:"plus-alt"},o={collection:e};i.channel("changes").request("register:change","addObject",a,null,l,o)}),e.trigger("reset",e),this.collection.reset()}i.channel("fields").request("sort:fields")},sortStagedFields:function(){var e=i.channel("app").request("get:stagedFieldsEl"),t=jQuery(e).sortable("toArray");_.each(this.collection.models,function(e){var n=e.get("id"),i=t.indexOf(n);e.set("order",i)}),this.collection.sort()},clearStagedFields:function(){this.collection.reset()}});return t}),n("controllers/fields/stagingSortable",["models/fields/stagingCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addField"),"startDrag:type",this.addActiveClass),this.listenTo(i.channel("drawer-addField"),"stopDrag:type",this.removeActiveClass),this.listenTo(i.channel("drawer-addField"),"receive:stagedFields",this.receiveStagedFields),this.listenTo(i.channel("drawer-addField"),"over:stagedFields",this.overStagedFields),this.listenTo(i.channel("drawer-addField"),"out:stagedFields",this.outStagedFields),this.listenTo(i.channel("drawer-addField"),"start:stagedFields",this.startStagedFields),this.listenTo(i.channel("drawer-addField"),"stop:stagedFields",this.stopStagedFields)},receiveStagedFields:function(e){if(jQuery(e.item).hasClass("nf-field-type-button")){var t=jQuery(e.item).data("id"),n=i.channel("fields").request("add:stagedField",t);jQuery(e.helper).prop("id",n),i.channel("fields").request("sort:staging"),jQuery(e.helper).remove(),i.channel("drawer-addField").trigger("drop:fieldType",t)}},addActiveClass:function(){var e=i.channel("app").request("get:stagedFieldsEl");jQuery(e).addClass("nf-droppable-active")},removeActiveClass:function(){var e=i.channel("app").request("get:stagedFieldsEl");jQuery(e).removeClass("nf-droppable-active")},overStagedFields:function(e,t){if(jQuery(t.item).hasClass("nf-field-type-button")){var n=jQuery(t.item).data("id"),r=i.channel("fields").request("get:type",n),a=r.get("nicename");this.currentHelper=t.helper,jQuery(t.helper).html(a+'<span class="dashicons dashicons-dismiss"></span>'),jQuery(t.helper).removeClass("nf-one-third").addClass("nf-item-dock").css({opacity:"0.8",width:"",height:""});var l=i.channel("app").request("get:stagedFieldsEl");jQuery(l).hasClass("ui-sortable")&&jQuery(l).addClass("nf-droppable-hover")}},outStagedFields:function(e){if(jQuery(e.item).hasClass("nf-field-type-button")){var t=i.channel("drawer-addField").request("get:typeHelperClone");jQuery(this.currentHelper).html(jQuery(t).html()),jQuery(this.currentHelper).removeClass("nf-item-dock").addClass("nf-one-third");var n=i.channel("app").request("get:stagedFieldsEl");jQuery(n).hasClass("ui-sortable")&&jQuery(n).removeClass("nf-droppable-hover")}},startStagedFields:function(e){jQuery(e.item).show(),jQuery(e.item).css({display:"inline",opacity:"0.7"}),jQuery(e.helper).css("opacity","0.5")},stopStagedFields:function(e){jQuery(e.item).css("opacity",""),jQuery(e.helper).remove()}});return t}),n("controllers/fields/filterTypes",["models/fields/typeSectionCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addField"),"change:filter",this.filterFieldTypes)},filterFieldTypes:function(t,n){if(""!=jQuery.trim(t)){var r=[];_.each(this.filterCollection(t),function(e){r.push(e.get("id"))});var a=new e([{id:"filtered",nicename:"Filtered Fields",fieldTypes:r}]);i.channel("drawer").trigger("filter:fieldTypes",a),n.addObject&&0<r.length&&(i.channel("fields").request("add:stagedField",r[0]),i.channel("drawer").request("clear:filter"))}else i.channel("drawer").trigger("clear:filter")},filterCollection:function(e){e=e.toLowerCase();var t=i.channel("fields").request("get:typeCollection"),n=t.filter(function(t){var n=!1;return-1!=t.get("id").toLowerCase().indexOf(e)?n=!0:-1!=t.get("nicename").toLowerCase().indexOf(e)&&(n=!0),t.get("tags")&&0==e.indexOf("#")&&_.each(t.get("tags"),function(t){e.replace("#","").length>1&&-1!=t.toLowerCase().indexOf(e.replace("#",""))&&(n=!0)}),t.get("alias")&&_.each(t.get("alias"),function(t){-1!=t.toLowerCase().indexOf(e)&&(n=!0)}),n});return n}});return t}),n("controllers/fields/sortable",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addField"),"startDrag:type",this.addActiveClass),this.listenTo(i.channel("drawer-addField"),"stopDrag:type",this.removeActiveClass),this.listenTo(i.channel("drawer-addField"),"startDrag:fieldStaging",this.addActiveClass),this.listenTo(i.channel("drawer-addField"),"stopDrag:fieldStaging",this.removeActiveClass),i.channel("app").reply("receive:fieldsSortable",this.receiveFieldsSortable,this),i.channel("app").reply("over:fieldsSortable",this.overfieldsSortable,this),i.channel("app").reply("out:fieldsSortable",this.outFieldsSortable,this),i.channel("app").reply("stop:fieldsSortable",this.stopFieldsSortable,this),i.channel("app").reply("start:fieldsSortable",this.startFieldsSortable,this),i.channel("app").reply("update:fieldsSortable",this.updateFieldsSortable,this)},addActiveClass:function(){var e=i.channel("fields").request("get:sortableEl");jQuery(e).addClass("nf-droppable-active")},removeActiveClass:function(){var e=i.channel("fields").request("get:sortableEl");jQuery(e).removeClass("nf-droppable-active")},receiveFieldsSortable:function(e){if(jQuery(e.item).hasClass("nf-field-type-button")){var t=jQuery(e.item).data("id"),n=this.addField(t,!1);jQuery(e.helper).prop("id",n),i.channel("fields").request("sort:fields"),jQuery(e.helper).remove(),i.channel("fields").trigger("drop:fieldType",t)}else if(jQuery(e.item).hasClass("nf-stage")){var r=this;i.channel("fields").request("sort:staging");var a=i.channel("fields").request("get:staging"),l=i.channel("fields").request("get:sortableEl");if(jQuery(l).hasClass("ui-sortable"))var o=jQuery(l).sortable("toArray");else var o=["nf-staged-fields-drag"];var s=o.indexOf("nf-staged-fields-drag");_.each(a.models,function(e,t){var n=r.addField(e.get("slug"));o.splice(s+t,0,n)});var s=o.indexOf("nf-staged-fields-drag");o.splice(s,1),i.channel("fields").request("sort:fields",o),i.channel("fields").request("clear:staging"),jQuery(e.helper).remove()}},addField:function(e,t){t=t||!1;var n=i.channel("fields").request("get:type",e),r=i.channel("fields").request("get:tmpFieldID"),a=i.channel("fields").request("add",{id:r,label:n.get("nicename"),type:n.get("id")},t),l={object:"Field",label:a.get("label"),change:"Added",dashicon:"plus-alt"},o={collection:i.channel("fields").request("get:collection")};return i.channel("changes").request("register:change","addObject",a,null,l,o),r},overfieldsSortable:function(e){if(jQuery(e.item).hasClass("nf-field-type-button")){var t=jQuery(e.helper).data("id"),n=i.channel("fields").request("get:type",t),r=n.get("nicename"),a=i.channel("fields").request("get:sortableEl"),l=jQuery(a).width();this.currentHelper=e.helper,jQuery(e.helper).html(r),jQuery(e.helper).removeClass("nf-one-third").addClass("nf-field-wrap").css({width:l,height:"50px"}),jQuery(a).hasClass("ui-sortable")&&jQuery(a).addClass("nf-droppable-hover")}else if(jQuery(e.item).hasClass("nf-stage")){var a=i.channel("fields").request("get:sortableEl");jQuery(a).hasClass("ui-sortable")&&jQuery(a).addClass("nf-droppable-hover")}},outFieldsSortable:function(e){if(jQuery(e.item).hasClass("nf-field-type-button")){var t=i.channel("drawer-addField").request("get:typeHelperClone");jQuery(this.currentHelper).html(jQuery(t).html()),jQuery(this.currentHelper).removeClass("nf-field-wrap").addClass("nf-one-third").css({width:"",height:""});var n=i.channel("fields").request("get:sortableEl");jQuery(n).hasClass("ui-sortable")&&jQuery(n).removeClass("nf-droppable-hover")}else if(jQuery(e.item).hasClass("nf-stage")){var n=i.channel("fields").request("get:sortableEl");jQuery(n).hasClass("ui-sortable")&&jQuery(n).removeClass("nf-droppable-hover")}},stopFieldsSortable:function(e){jQuery(e.item).css("opacity",""),jQuery(e.helper).remove()},startFieldsSortable:function(e){jQuery(e.item).hasClass("nf-field-type-button")||jQuery(e.item).hasClass("nf-stage")||jQuery(e.item).css("opacity","0.5").show()},updateFieldsSortable:function(e){if(i.channel("fields").request("sort:fields"),!jQuery(e.item).hasClass("nf-field-type-button")&&!jQuery(e.item).hasClass("nf-stage")){var t=i.channel("fields").request("get:collection"),n=jQuery(e.item).prop("id").replace("field-",""),r=t.get(n),a={fields:[]};_.each(t.models,function(e){var t=e._previousAttributes.order,n=e.get("order");a.fields.push({model:e,attr:"order",before:t,after:n})});var l={object:"Field",label:r.get("label"),change:"Re-ordered from "+r._previousAttributes.order+" to "+r.get("order"),dashicon:"sort"};i.channel("changes").request("register:change","sortFields",r,null,l,a)}}});return e}),n("models/fields/fieldModel",[],function(){var e=Backbone.Model.extend({defaults:{objectType:"Field",objectDomain:"fields",editActive:!1},initialize:function(){this.bind("change",this.changeSetting,this);var e=i.channel("fields").request("get:type",this.get("type")),t=e.get("parentType"),n=this;_.each(e.get("settingDefaults"),function(e,t){n.get(t)||n.set(t,e)}),i.channel("fields").trigger("init:fieldModel",this),i.channel("fields-"+t).trigger("init:fieldModel",this),i.channel("fields-"+this.get("type")).trigger("init:fieldModel",this)},changeSetting:function(){i.channel("app").trigger("update:setting",this)}});return e}),n("models/fields/fieldCollection",["models/fields/fieldModel"],function(e){var t=Backbone.Collection.extend({model:e,comparator:"order",tmpNum:1,initialize:function(){this.on("add",this.addField,this),this.on("remove",this.removeField,this),this.newIDs=[]},addField:function(e){this.newIDs.push(e.get("id"))},removeField:function(e){this.removedIDs[e.get("id")]=e.get("id")}});return t}),n("controllers/fields/data",["models/fields/fieldCollection","models/fields/fieldModel"],function(e,t){var n=Marionette.Object.extend({initialize:function(){this.collection=new e(preloadedFormData.fields),this.collection.removedIDs={},i.channel("fields").reply("get:collection",this.getFieldCollection,this),i.channel("fields").reply("get:field",this.getField,this),i.channel("fields").reply("get:tmpFieldID",this.getTmpFieldID,this),i.channel("fields").reply("get:tmpID",this.getTmpFieldID,this),i.channel("fields").reply("add",this.addField,this),i.channel("fields").reply("delete",this.deleteField,this),i.channel("fields").reply("sort:fields",this.sortFields,this)},getFieldCollection:function(){return this.collection},getField:function(e){return this.collection.get(e)},addField:function(e,n){if(n=n||!1,!1==e instanceof Backbone.Model)var r=new t(e);else var r=e;return this.collection.add(r,{silent:n}),i.channel("app").request("update:setting","clean",!1),r},updateFieldSetting:function(e,t,n){var i=this.collection.get(e);i.set(t,n)},sortFields:function(e,t){var n=i.channel("fields").request("get:sortableEl");if(jQuery(n).hasClass("ui-sortable")){var e=e||jQuery(n).sortable("toArray");_.each(this.collection.models,function(t){var n=(t.get("order"),t.get("id"));if(jQuery.isNumeric(n))var i="field-"+n;else var i=n;var r=e.indexOf(i)+1;t.set("order",r)}),this.collection.sort(),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")}},deleteField:function(e){this.collection.remove(e),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")},getTmpFieldID:function(){var e=this.collection.tmpNum;return this.collection.tmpNum++,"tmp-"+e}});return n}),n("models/fields/listOptionModel",[],function(){var e=Backbone.Model.extend({});return e}),n("models/fields/listOptionCollection",["models/fields/listOptionModel"],function(e){var t=Backbone.Collection.extend({model:e,comparator:"order",initialize:function(){this.on("sort",this.changeCollection,this),this.on("add",this.addOption,this)},changeCollection:function(){i.channel("option-repeater").trigger("sort:options",this)},addOption:function(e,t){!e.get("order")}});return t}),n("views/fields/drawer/typeSettingListOption",[],function(){var e=Marionette.ItemView.extend({tagName:"div",className:"nf-table-row",template:"#nf-tmpl-edit-setting-list-option",initialize:function(e){this.dataModel=e.dataModel,this.collection=e.collection,this.columns=e.columns},onRender:function(){jQuery(this.el).prop("id",this.model.cid)},onShow:function(){jQuery(this.el).find("input:first").focus()},events:{"change input":"changeOption","click .nf-delete":"deleteOption",keyup:"maybeAddOption"},changeOption:function(e){i.channel("option-repeater").trigger("change:option",e,this.model,this.dataModel)},deleteOption:function(e){i.channel("option-repeater").trigger("click:deleteOption",this.model,this.collection,this.dataModel)},maybeAddOption:function(e){13==e.keyCode&&i.channel("option-repeater").trigger("click:addOption",this.collection,this.dataModel)},templateHelpers:function(){var e=this;return{getColumns:function(){return e.columns}}}});return e}),n("views/fields/drawer/typeSettingListEmpty",[],function(){var e=Marionette.ItemView.extend({tagName:"tr",template:"#nf-tmpl-edit-setting-list-empty"});return e}),n("views/fields/drawer/typeSettingListComposite",["views/fields/drawer/typeSettingListOption","views/fields/drawer/typeSettingListEmpty"],function(e,t){var n=Marionette.CompositeView.extend({template:"#nf-tmpl-edit-setting-wrap",childView:e,emptyView:t,initialize:function(e){this.collection=e.dataModel.get("options"),this.dataModel=e.dataModel,this.childViewOptions={collection:this.collection,dataModel:e.dataModel,columns:this.model.get("columns")}},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el),this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el);var e=this;jQuery(this.el).find(".nf-list-options-tbody").sortable({handle:".handle",helper:"clone",placeholder:"nf-list-options-sortable-placeholder",forcePlaceholderSize:!0,opacity:.95,tolerance:"pointer",start:function(e,t){i.channel("option-repeater").request("start:optionSortable",t)},stop:function(e,t){i.channel("option-repeater").request("stop:optionSortable",t)},update:function(t,n){i.channel("option-repeater").request("update:optionSortable",n,this,e)}})},templateHelpers:function(){return{renderHeaders:function(){var e="<div>&nbsp;</div>";return-1!=this.columns.indexOf("label")&&(e+="<div>Label</div>"),-1!=this.columns.indexOf("value")&&(e+="<div>Value</div>"),-1!=this.columns.indexOf("calc")&&(e+="<div>Calc Value</div>"),-1!=this.columns.indexOf("selected")&&(e+='<div><span class="dashicons dashicons-yes"></span></div>'),e+="<div>&nbsp;</div>"},renderSetting:function(){return _.template(jQuery("#nf-tmpl-edit-setting-"+this.type).html(),this)},renderWidth:function(){return"undefined"!=typeof this.width?this.width:"one-half"}}},attachHtml:function(e,t){jQuery(e.el).find(".nf-list-options-tbody").append(t.el)},events:{"click .nf-add-new":"clickAddOption"},clickAddOption:function(e){i.channel("option-repeater").trigger("click:addOption",this.collection,this.dataModel)}});return n}),n("controllers/fields/optionRepeater",["models/fields/listOptionModel","models/fields/listOptionCollection","views/fields/drawer/typeSettingListComposite"],function(e,t,n){var r=Marionette.Object.extend({initialize:function(){i.channel("option-repeater").reply("get:settingChildView",this.getSettingChildView,this),this.listenTo(i.channel("fields"),"init:fieldModel",this.createOptionCollection),this.listenTo(i.channel("option-repeater"),"change:option",this.changeOption),this.listenTo(i.channel("option-repeater"),"click:addOption",this.addOption),this.listenTo(i.channel("option-repeater"),"click:deleteOption",this.deleteOption),i.channel("option-repeater").reply("update:optionSortable",this.updateOptionSortable,this),i.channel("option-repeater").reply("stop:optionSortable",this.stopOptionSortable,this),i.channel("option-repeater").reply("start:optionSortable",this.startOptionSortable,this)},createOptionCollection:function(e){var n=e.get("options");if("option-repeater"==n&&e.set("options",[{calc:1,label:"One",value:"one",order:0,selected:0},{calc:2,label:"Two",value:"two",order:1,selected:0},{calc:3,label:"Three",value:"three",order:2,selected:0}],{silent:!0}),0==n instanceof Backbone.Collection){var i=new t;i.add(e.get("options")),e.set("options",i,{silent:!0})}},changeOption:function(e,t,n){var r=jQuery(e.target).data("id");if("selected"==r)if(jQuery(e.target).attr("checked"))var a=1;else var a=0;else var a=jQuery(e.target).val();var l=t.get(r);t.set(r,a),this.triggerFieldModel(t,n);var o=a,s={attr:r,before:l,after:o},c={object:"Field",label:n.get("label"),change:"Option "+t.get("label")+" "+r+" changed from "+l+" to "+o};i.channel("changes").request("register:change","changeSetting",t,s,c)},addOption:function(t,n){var r=new e({label:"",value:"",calc:"",selected:0,order:t.length});t.add(r);var a={object:"Field",label:n.get("label"),change:"Option Added",dashicon:"plus-alt"};i.channel("changes").request("register:change","addListOption",r,null,a),this.triggerFieldModel(r,n)},deleteOption:function(e,t,n){var r=i.channel("app").request("clone:modelDeep",e),a={object:"Field",label:n.get("label"),change:"Option "+r.get("label")+" Removed",dashicon:"dismiss"},l={collection:t};i.channel("changes").request("register:change","removeListOption",r,null,a,l);var o=i.channel("changes").request("get:changeCollection"),s=o.where({model:e});_.each(s,function(e){"object"==typeof e.get("data")&&_.each(e.get("data"),function(e){e.model==n&&(e.model=r)}),e.set("model",r),e.set("disabled",!0)}),t.remove(e),this.triggerFieldModel(e,n)},triggerFieldModel:function(e,t){i.channel("app").trigger("update:setting",e)},getSettingChildView:function(e){return n},updateOptionSortable:function(e,t,n){var r=jQuery(t).sortable("toArray"),a=n.collection.get({cid:jQuery(e.item).prop("id")}),l={collection:n.collection,objModels:[]};_.each(r,function(e,t){var i=n.collection.get({cid:e}),r=i.get("order");i.set("order",t);var a=t;l.objModels.push({model:i,attr:"order",before:r,after:a})}),n.collection.sort();var o={object:"Field",label:n.fieldModel.get("label"),change:"Option "+a.get("label")+" re-ordered from "+a._previousAttributes.order+" to "+a.get("order"),dashicon:"sort"};i.channel("changes").request("register:change","sortListOptions",a,null,o,l),this.triggerFieldModel(a,n.fieldModel)},stopOptionSortable:function(e){jQuery(e.item).css("opacity","")},startOptionSortable:function(e){jQuery(e.placeholder).find("div").remove(),jQuery(e.item).css("opacity","0.5").show()}});return r}),n("controllers/fields/editActive",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("fields").reply("clear:editActive",this.clearEditActive,this),this.listenTo(i.channel("drawer-editSettings"),"before:closeDrawer",this.clearEditActive)},clearEditActive:function(){var e=i.channel("fields").request("get:collection");_.each(e.models,function(e){e.set("editActive",!1)})}});return e}),n("controllers/fields/fieldSettings",["models/app/settingCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.collection=new e(fieldSettings),i.channel("fields").reply("get:settingModel",this.getSettingModel,this)},getSettingModel:function(e){return this.collection.findWhere({name:e})}});return t}),n("controllers/fields/fieldQuantity",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"before:renderSetting",this.beforeRenderSetting)},register:function(e){},beforeRenderSetting:function(e,t,n){if("product_assignment"==e.get("name")){var i=this.getProductFields(e);e.set("options",i)}},getProductFields:function(e){var t=[e.get("select_product")],n=i.channel("fields").request("get:collection");return _.each(n.models,function(e){"product"==e.get("type")&&t.push({label:e.get("label"),value:e.get("id")})}),t}});return e}),n("controllers/actions/types",["models/app/typeCollection","models/app/settingCollection","models/app/settingGroupCollection"],function(e,t,n){var r=Marionette.Object.extend({initialize:function(){this.installedActions=new e,this.installedActions.slug="installed",this.installedActions.nicename="Installed",this.availableActions=new e,this.availableActions.slug="available",this.availableActions.nicename="Available";var r=this;_.each(actionTypeData,function(e){var i=new n;_.each(e.settingGroups,function(e){var n={label:e.label,display:e.display,settings:new t(e.settings)};i.add(n)});var a={id:e.id,nicename:e.nicename,alias:e.alias,settingGroups:i,settingDefaults:e.settingDefaults,image:e.image,link:e.link,section:e.section};r[e.section+"Actions"].add(a)}),i.channel("actions").reply("get:type",this.getType,this),i.channel("actions").reply("get:installedActions",this.getInstalledActions,this),i.channel("actions").reply("get:availableActions",this.getAvailableActions,this)},getType:function(e){var t=this.installedActions.get(e);return t||(t=this.availableActions.get(e)),t},getInstalledActions:function(){return this.installedActions},getAvailableActions:function(){return this.availableActions},addStagedField:function(e){var t=jQuery(e.target).data("id");i.channel("fields").request("add:stagedField",t)},getTypeSections:function(){return this.fieldTypeSections}});return r}),n("models/actions/actionModel",[],function(){var e=Backbone.Model.extend({defaults:{objectType:"Action",objectDomain:"actions",editActive:!1},initialize:function(){this.bind("change",this.changeSetting,this);var e=i.channel("actions").request("get:type",this.get("type")),t=this;_.each(e.get("settingDefaults"),function(e,n){t.get(n)||t.set(n,e)}),i.channel("actions").trigger("init:fieldModel",this),i.channel("actions-"+this.get("type")).trigger("init:fieldModel",this)},changeSetting:function(){i.channel("app").trigger("update:setting",this)}});return e}),n("models/actions/actionCollection",["models/actions/actionModel"],function(e){var t=Backbone.Collection.extend({model:e,comparator:"order",tmpNum:1,initialize:function(){this.on("add",this.addAction,this),this.on("remove",this.removeAction,this),this.newIDs=[]},addAction:function(e){this.newIDs.push(e.get("id"))},removeAction:function(e){this.removedIDs[e.get("id")]=e.get("id")}});return t}),n("controllers/actions/data",["models/actions/actionCollection","models/actions/actionModel"],function(e,t){var n=Marionette.Object.extend({initialize:function(){this.collection=new e(preloadedFormData.actions),this.collection.removedIDs={},i.channel("actions").reply("get:collection",this.getCollection,this),i.channel("actions").reply("get:action",this.getAction,this),i.channel("actions").reply("get:tmpID",this.getTmpID,this),i.channel("actions").reply("add",this.addAction,this),i.channel("actions").reply("delete",this.deleteAction,this)},getCollection:function(){return this.collection},getAction:function(e){return this.collection.get(e)},addAction:function(e,n){if(n=n||!1,!1==e instanceof Backbone.Model)var r=new t(e);else var r=e;return this.collection.add(r,{silent:n}),i.channel("app").request("update:setting","clean",!1),r},deleteAction:function(e){this.collection.remove(e),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")},getTmpID:function(){var e=this.collection.tmpNum;return this.collection.tmpNum++,"tmp-"+e}});return n}),n("controllers/actions/actionSettings",["models/app/settingCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.collection=new e(actionSettings),i.channel("actions").reply("get:settingModel",this.getSettingModel,this)},getSettingModel:function(e){return this.collection.findWhere({name:e})}});return t}),n("controllers/actions/editActive",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("actions").reply("clear:editActive",this.clearEditActive,this),this.listenTo(i.channel("drawer-editSettings"),"before:closeDrawer",this.clearEditActive)},clearEditActive:function(){var e=i.channel("actions").request("get:collection");_.each(e.models,function(e){e.set("editActive",!1)})}});return e}),n("controllers/actions/addActionTypes",["models/actions/actionCollection","models/actions/actionModel"],function(e,t){var n=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("actions"),"click:addAction",this.addAction),i.channel("actions").reply("add:actionType",this.addAction,this)},addAction:function(e){var t={id:i.channel("actions").request("get:tmpID"),type:e.get("id"),label:e.get("nicename")},n=i.channel("actions").request("add",t),r={object:"Action",label:n.get("label"),change:"Added",dashicon:"plus-alt"},t={collection:i.channel("actions").request("get:collection")};i.channel("changes").request("register:change","addObject",n,null,r,t),i.channel("app").trigger("click:edit",{},n)}});return n}),n("controllers/actions/typeDrag",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("drawer-addAction"),"startDrag:type",this.startDrag),this.listenTo(i.channel("drawer-addAction"),"stopDrag:type",this.stopDrag),i.channel("drawer-addAction").reply("get:typeHelperClone",this.getCurrentDraggableHelperClone,this)},startDrag:function(e,t){this.drawerEl=i.channel("app").request("get:drawerEl"),this.mainEl=i.channel("app").request("get:mainEl"),jQuery(this.drawerEl)[0].style.setProperty("overflow","visible","important"),jQuery(this.mainEl)[0].style.setProperty("overflow","visible","important"),this.draggableHelperClone=jQuery(t.helper).clone()},stopDrag:function(e,t){jQuery(this.drawerEl)[0].style.setProperty("overflow","hidden","important"),jQuery(this.mainEl)[0].style.setProperty("overflow","hidden","important")},getCurrentDraggableHelperClone:function(){return this.draggableHelperClone}});return e}),n("controllers/actions/droppable",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("app").reply("drop:actionType",this.dropActionType,this)},dropActionType:function(e,t){var n=jQuery(t.helper).data("type"),r=i.channel("actions").request("get:type",n);i.channel("actions").request("add:actionType",r)}});return e}),n("models/actions/typeModel",[],function(){var e=Backbone.Model.extend({});return e}),n("models/actions/typeCollection",["models/actions/typeModel"],function(e){var t=Backbone.Collection.extend({model:e});return t}),n("controllers/actions/filterTypes",["models/actions/typeCollection"],function(e){var t=Marionette.Object.extend({
initialize:function(){this.listenTo(i.channel("drawer-addAction"),"change:filter",this.filterActionTypes)},filterActionTypes:function(t,n){if(""!=jQuery.trim(t)){var r=[],a=i.channel("actions").request("get:installedActions");_.each(this.filterCollection(t,a),function(e){r.push(e)});var l=[],o=i.channel("actions").request("get:availableActions");_.each(this.filterCollection(t,o),function(e){l.push(e)});var s=new e(r);s.slug="installed",s.nicename="Installed";var c=new e(l);c.slug="available",c.nicename="Available",i.channel("drawer").trigger("filter:actionTypes",s,c),n.addObject&&0<s.length&&(i.channel("actions").request("add:actionType",s.models[0]),i.channel("drawer").request("clear:filter"))}else i.channel("drawer").trigger("clear:filter")},filterCollection:function(e,t){e=e.toLowerCase();var n=t.filter(function(t){var n=!1;return-1!=t.get("id").toLowerCase().indexOf(e)?n=!0:-1!=t.get("nicename").toLowerCase().indexOf(e)&&(n=!0),t.get("tags")&&0==e.indexOf("#")&&_.each(t.get("tags"),function(t){e.replace("#","").length>1&&-1!=t.toLowerCase().indexOf(e.replace("#",""))&&(n=!0)}),t.get("alias")&&_.each(t.get("alias"),function(t){-1!=t.toLowerCase().indexOf(e)&&(n=!0)}),n});return n}});return t}),n("controllers/settings/types",["models/app/typeCollection","models/app/settingCollection","models/app/settingGroupCollection"],function(e,t,n){var r=Marionette.Object.extend({initialize:function(){this.collection=new e;var r=this;_.each(formSettingTypeData,function(e){var i=new n;_.each(e.settingGroups,function(e){var n={label:e.label,display:e.display,settings:new t(e.settings)};i.add(n)});var a={id:e.id,nicename:e.nicename,alias:e.alias,settingGroups:i,settingDefaults:e.settingDefaults,editActive:!1};r.collection.add(a)}),i.channel("settings").reply("get:type",this.getType,this),i.channel("settings").reply("get:typeCollection",this.getCollection,this)},getType:function(e){return this.collection.get(e)},getCollection:function(){return this.collection}});return r}),n("models/settings/settingsModel",[],function(){var e=Backbone.Model.extend({defaults:{objectType:"Form Setting",editActive:!1},initialize:function(){this.bind("change",this.changeSetting,this)},changeSetting:function(){i.channel("app").trigger("update:setting",this)}});return e}),n("controllers/settings/data",["models/settings/settingsModel"],function(e){var t=Marionette.Object.extend({initialize:function(){this.model=new e(preloadedFormData.settings),i.channel("settings").reply("get:settings",this.getSettings,this)},getSettings:function(){return this.model}});return t}),n("controllers/settings/formSettings",["models/app/settingCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){this.collection=new e(formSettings),i.channel("settings").reply("get:settingModel",this.getSettingModel,this)},getSettingModel:function(e){return this.collection.findWhere({name:e})}});return t}),n("controllers/settings/editActive",[],function(){var e=Marionette.Object.extend({initialize:function(){i.channel("settings").reply("clear:editActive",this.clearEditActive,this),this.listenTo(i.channel("drawer-editSettings"),"before:closeDrawer",this.clearEditActive)},clearEditActive:function(){var e=i.channel("settings").request("get:typeCollection");_.each(e.models,function(e){e.set("editActive",!1)})}});return e}),n("controllers/settings/clickEdit",["models/settings/settingsModel"],function(e){var t=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("settings"),"click:edit",this.clickEdit)},clickEdit:function(e,t){i.channel("settings").request("clear:editActive"),t.set("editActive",!0);var n=i.channel("settings").request("get:settings");i.channel("app").request("open:drawer","editSettings",{model:n,groupCollection:t.get("settingGroups")})}});return t}),n("controllers/loadControllers",["controllers/app/drawer","controllers/app/drawerConfig","controllers/app/domainConfig","controllers/app/data","controllers/app/drawerToggleSettingGroup","controllers/app/updateDB","controllers/app/formData","controllers/app/previewLink","controllers/app/menuButtons","controllers/app/trackChanges","controllers/app/undoChanges","controllers/app/publishResponse","controllers/app/changeDomain","controllers/app/pushstate","controllers/app/hotkeys","controllers/app/cleanState","controllers/app/coreUndo","controllers/app/cloneModelDeep","controllers/app/getSettingChildView","controllers/app/changeSettingDefault","controllers/app/fieldset","controllers/app/toggleSetting","controllers/app/itemControls","controllers/app/mergeTags","controllers/app/itemSettingFill","controllers/fields/types","controllers/fields/fieldTypeDrag","controllers/fields/stagingDrag","controllers/fields/savedFieldsSection","controllers/fields/staging","controllers/fields/stagingSortable","controllers/fields/filterTypes","controllers/fields/sortable","controllers/fields/data","controllers/fields/optionRepeater","controllers/fields/editActive","controllers/fields/fieldSettings","controllers/fields/fieldQuantity","controllers/actions/types","controllers/actions/data","controllers/actions/actionSettings","controllers/actions/editActive","controllers/actions/addActionTypes","controllers/actions/typeDrag","controllers/actions/droppable","controllers/actions/filterTypes","controllers/settings/types","controllers/settings/data","controllers/settings/formSettings","controllers/settings/editActive","controllers/settings/clickEdit"],function(e,t,n,i,r,a,l,o,s,c,d,h,u,p,g,f,m,v,w,y,b,C,j,S,D,M,T,q,F,k,Q,x,A,O,E,V,z,_,H,I,N,$,B,R,P,L,G,W,U,J,X){var K=Marionette.Object.extend({initialize:function(){new g,new e,new t,new n,new r,new a,new o,new s,new c,new d,new h,new u,new f,new m,new v,new j,new b,new E,new M,new T,new q,new F,new k,new Q,new x,new A,new y,new C,new w,new V,new z,new _,new H,new I,new N,new $,new B,new R,new P,new L,new G,new U,new W,new J,new X,new O,new l,new i,new S,new D}});return K}),t.config({baseUrl:nfAdmin.requireBaseUrl+"/builder/"});var i=Backbone.Radio;jQuery(document).ready(function(e){t(["views/app/builder","controllers/loadControllers"],function(e,t){var n=Marionette.Application.extend({initialize:function(e){i.channel("app").trigger("before:loadControllers",this);new t;i.channel("app").trigger("after:loadControllers",this)},onStart:function(){new e;i.channel("app").trigger("after:appStart",this)}}),r=new n;r.start()})}),n("main",function(){})}();
//# sourceMappingURL=almond.build.js.map
//# sourceMappingURL=builder.js.map
